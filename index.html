<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva de Rendimiento de CPU en Kubernetes Virtualizado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is structured as a guided journey through five distinct layers of abstraction: Hardware, Hypervisor, Kubernetes, Performance Diagnostics, and Advanced Strategies. This thematic approach was chosen over mirroring the report's linear structure to allow users to build knowledge progressively. Navigation is facilitated by a sticky top bar. Key interactions include toggling between concepts, simulating resource contention with interactive charts, and exploring a diagnostic dashboard that connects symptoms to root causes. This structure enhances usability by breaking down a highly complex topic into digestible, interconnected modules. -->
    <!-- Visualization & Content Choices: 
         - CPU Core Anatomy: Goal: Inform. Method: Interactive HTML/CSS diagram. Interaction: Hovering over components reveals detailed descriptions. Justification: More engaging and clearer than a static text description.
         - Hyper-Threading Gain: Goal: Compare. Method: Bar chart (Chart.js). Interaction: A slider simulates different workloads, updating the chart to show variable performance gains. Justification: Visually demonstrates that HT benefit is not fixed.
         - vCPU Scheduling & NUMA: Goal: Organize/Inform. Method: Styled cards and tables. Interaction: Clickable tabs for different concepts. Justification: Simplifies the complex logic of the ESXi scheduler and memory locality.
         - Contention Metrics Dashboard: Goal: Relationships/Compare. Method: Three linked bar charts (Chart.js). Interaction: Selecting a "problem scenario" updates all three charts. Justification: Directly teaches users how to diagnose problems by connecting observable metrics to specific root causes.
         - QoS & Diagnostic Tables: Goal: Compare/Reference. Method: Interactive HTML tables. Interaction: Hovering highlights rows. Justification: Provides a clear, at-a-glance comparison and reference guide.
         - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nav-button { transition: all 0.3s ease; }
        .nav-button.active { color: #D97706; border-bottom-color: #D97706; font-weight: 600; }
        .dark .nav-button.active { color: #FBBF24; border-bottom-color: #FBBF24;}
        .content-section { display: none; animation: fadeIn 0.5s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .interactive-diagram .group .tooltip { opacity: 0; transform: translateY(4px); transition: opacity 0.3s ease, transform 0.3s ease; }
        .interactive-diagram .group:hover .tooltip { opacity: 1; transform: translateY(0); }
        .lang-btn.active { background-color: #D97706; color: white; }
        .dark .lang-btn.active { background-color: #FBBF24; color: #111827; }
        .card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .dark .card:hover { box-shadow: 0 20px 25px -5px rgb(255 255 255 / 0.1), 0 8px 10px -6px rgb(255 255 255 / 0.1); }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 antialiased">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        
        <header class="relative text-center py-16">
            <div class="absolute top-4 right-4 flex items-center space-x-4">
                <!-- Language Selector -->
                <div class="flex items-center space-x-1 rounded-lg p-1 bg-gray-200 dark:bg-gray-700">
                    <button id="lang-es" class="lang-btn px-2 py-1 text-sm rounded-md transition-colors">ES</button>
                    <button id="lang-en" class="lang-btn px-2 py-1 text-sm rounded-md transition-colors">EN</button>
                </div>
                <!-- Dark Mode Toggle -->
                <button id="theme-toggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300">
                    <svg id="theme-toggle-dark-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.464A1 1 0 106.465 13.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-1.414-2.12a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <h1 data-translate="main_title" class="text-4xl md:text-5xl font-bold text-gray-800 dark:text-white tracking-tight"></h1>
            <p data-translate="main_subtitle" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
        </header>

        <nav class="sticky top-0 z-10 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-sm rounded-xl mb-16">
            <div class="flex flex-wrap justify-center border-b border-gray-200 dark:border-gray-700">
                <button data-target="hardware" class="nav-button active text-gray-600 dark:text-gray-300 hover:text-amber-600 dark:hover:text-amber-400 font-medium py-4 px-5 border-b-2 border-transparent"><span data-translate="nav_hardware"></span></button>
                <button data-target="hypervisor" class="nav-button text-gray-600 dark:text-gray-300 hover:text-amber-600 dark:hover:text-amber-400 font-medium py-4 px-5 border-b-2 border-transparent"><span data-translate="nav_hypervisor"></span></button>
                <button data-target="kubernetes" class="nav-button text-gray-600 dark:text-gray-300 hover:text-amber-600 dark:hover:text-amber-400 font-medium py-4 px-5 border-b-2 border-transparent"><span data-translate="nav_kubernetes"></span></button>
                <button data-target="diagnostics" class="nav-button text-gray-600 dark:text-gray-300 hover:text-amber-600 dark:hover:text-amber-400 font-medium py-4 px-5 border-b-2 border-transparent"><span data-translate="nav_diagnostics"></span></button>
                <button data-target="strategies" class="nav-button text-gray-600 dark:text-gray-300 hover:text-amber-600 dark:hover:text-amber-400 font-medium py-4 px-5 border-b-2 border-transparent"><span data-translate="nav_strategies"></span></button>
            </div>
        </nav>

        <main>
            <!-- Hardware Section -->
            <section id="hardware" class="content-section active mb-20">
                <div class="text-center mb-16">
                    <h2 data-translate="hardware_title" class="text-3xl font-bold text-gray-800 dark:text-white"></h2>
                    <p data-translate="hardware_intro" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
                </div>

                <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-8 items-stretch">
                    <!-- Column 1: Standard Core -->
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 h-full">
                        <h3 data-translate="core_no_smt_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6 text-center"></h3>
                        <div class="border-2 border-gray-300 dark:border-gray-600 rounded-lg p-4 flex flex-col items-center text-center space-y-4">
                            <h4 class="font-bold text-lg dark:text-white" data-translate="physical_core"></h4>
                            <div class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-md">
                                <p class="font-semibold" data-translate="architectural_state"></p>
                                <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded mt-2" data-translate="single_thread"></div>
                            </div>
                            <div class="w-full p-4 bg-orange-100 dark:bg-orange-900/50 rounded-md">
                                <p class="font-semibold" data-translate="execution_units"></p>
                                <div class="grid grid-cols-3 gap-2 mt-2">
                                    <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">ALU</div>
                                    <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">FPU</div>
                                    <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">Load/Store</div>
                                </div>
                            </div>
                        </div>
                         <p data-translate="core_no_smt_desc" class="text-base text-gray-600 dark:text-gray-400 mt-6 text-center"></p>
                    </div>

                    <!-- Column 2: SMT Core -->
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 h-full">
                         <h3 data-translate="core_smt_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6 text-center"></h3>
                         <div class="interactive-diagram border-2 border-amber-500 dark:border-amber-400 rounded-lg p-4 flex flex-col items-center text-center space-y-4">
                             <h4 class="font-bold text-lg dark:text-white" data-translate="physical_core"></h4>
                             <div class="w-full p-4 bg-amber-100 dark:bg-amber-900/50 rounded-md relative group">
                                 <p class="font-semibold" data-translate="arch_state_duplicated"></p>
                                 <div class="flex justify-around mt-2">
                                     <div class="p-2 bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200 rounded w-5/12" data-translate="logical_thread_1"></div>
                                     <div class="p-2 bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200 rounded w-5/12" data-translate="logical_thread_2"></div>
                                 </div>
                                 <span data-translate="arch_state_tooltip" class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs bg-gray-800 text-white text-sm rounded-md px-3 py-1 pointer-events-none"></span>
                             </div>
                             <div class="w-full p-4 bg-orange-100 dark:bg-orange-900/50 rounded-md relative group">
                                 <p class="font-semibold" data-translate="exec_units_shared"></p>
                                 <div class="grid grid-cols-3 gap-2 mt-2">
                                     <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">ALU</div>
                                     <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">FPU</div>
                                     <div class="p-2 bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded">Load/Store</div>
                                 </div>
                                 <span data-translate="exec_units_tooltip" class="tooltip absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max max-w-xs bg-gray-800 text-white text-sm rounded-md px-3 py-1 pointer-events-none"></span>
                             </div>
                         </div>
                         <p data-translate="core_smt_desc" class="text-base text-gray-600 dark:text-gray-400 mt-6 text-center"></p>
                    </div>
                </div>

                <!-- Restructured Content Section -->
                <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-8 mt-12 items-start">
                    <!-- Left Column -->
                    <div class="space-y-8">
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                            <h3 data-translate="execution_flow_no_smt_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6 text-center"></h3>
                            <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4">
                                <div class="bg-gray-100 dark:bg-gray-700 rounded-md p-4 flex justify-center items-center space-x-3 h-16">
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                    <div class="w-6 h-6 border-2 border-dashed border-blue-500 rounded-full"></div>
                                    <div class="w-6 h-6 border-2 border-dashed border-blue-500 rounded-full"></div>
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                </div>
                            </div>
                            <p data-translate="execution_flow_no_smt_desc" class="text-base text-gray-600 dark:text-gray-400 mt-4 text-center"></p>
                        </div>
                    </div>
                    <!-- Right Column -->
                    <div class="space-y-8">
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                            <h3 data-translate="execution_flow_smt_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6 text-center"></h3>
                             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4">
                                <div class="bg-gray-100 dark:bg-gray-700 rounded-md p-4 flex justify-center items-center space-x-3 h-16">
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                    <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                    <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                    <div class="w-6 h-6 bg-blue-500 rounded"></div>
                                </div>
                            </div>
                            <p data-translate="execution_flow_smt_desc" class="text-base text-gray-600 dark:text-gray-400 mt-4 text-center"></p>
                        </div>
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                            <h3 data-translate="ht_benefit_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                            <p data-translate="ht_benefit_desc" class="text-base text-gray-600 dark:text-gray-400 mb-4"></p>
                            <label for="workload-slider" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-100"><span data-translate="workload_type"></span>: <span id="workload-label" class="font-bold text-amber-600 dark:text-amber-400"></span></label>
                            <input id="workload-slider" type="range" min="15" max="30" value="22" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer">
                            <div class="chart-container mt-6 h-64">
                                <canvas id="htChart"></canvas>
                            </div>
                        </div>
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                            <h3 data-translate="security_risks_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                            <p data-translate="security_risks_desc" class="text-base text-gray-600 dark:text-gray-400 mb-4"></p>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                     <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="tip_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <div class="bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                            <p data-translate="security_risks_tip" class="text-sm text-yellow-700 dark:text-yellow-300"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Hypervisor Section -->
            <section id="hypervisor" class="content-section mb-20">
                <div class="text-center mb-16">
                    <h2 data-translate="hypervisor_title" class="text-3xl font-bold text-gray-800 dark:text-white"></h2>
                    <p data-translate="hypervisor_intro" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
                </div>
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="esxi_scheduler_title" class="text-2xl font-semibold text-gray-800 dark:text-white mb-8"></h3>
                        <div class="space-y-8">
                            <div>
                                <h4 data-translate="golden_rule_title" class="font-semibold text-lg mb-2"></h4>
                                <p data-translate="golden_rule_desc" class="text-base text-gray-600 dark:text-gray-400 mb-4"></p>
                            </div>
                            <div>
                                <h4 data-translate="relaxed_cosched_title" class="font-semibold text-lg mb-2"></h4>
                                <p data-translate="relaxed_cosched_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </div>
                             <div>
                                <h4 data-translate="cpu_resources_title" class="font-semibold text-lg mb-2"></h4>
                                <p data-translate="cpu_resources_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </div>
                            <div>
                                <h4 data-translate="numa_title" class="font-semibold text-lg mb-2"></h4>
                                <p data-translate="numa_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                                <div class="mt-6 p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg">
                                    <h3 class="text-center font-bold text-lg text-orange-800 dark:text-orange-300 mb-4" data-translate="server_diagram_title"></h3>
                                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <!-- NUMA Node 1 -->
                                            <div class="p-4 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg text-center">
                                                <h4 class="font-semibold text-amber-800 dark:text-amber-300" data-translate="numa_node_diagram"></h4>
                                                <div class="mt-2 p-3 bg-white dark:bg-gray-800 rounded-md shadow-sm">
                                                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300" data-translate="processor_package_diagram"></p>
                                                    <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                    </div>
                                                </div>
                                                <div class="mt-2 p-2 bg-orange-200 dark:bg-orange-800 rounded-md text-sm font-medium text-orange-800 dark:text-orange-200" data-translate="socket_diagram"></div>
                                                <div class="flex justify-center gap-1 mt-2">
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                </div>
                                            </div>
                                            <!-- NUMA Node 2 -->
                                            <div class="p-4 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg text-center">
                                                <h4 class="font-semibold text-amber-800 dark:text-amber-300" data-translate="numa_node_diagram"></h4>
                                                <div class="mt-2 p-3 bg-white dark:bg-gray-800 rounded-md shadow-sm">
                                                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300" data-translate="processor_package_diagram"></p>
                                                    <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded" data-translate="core_diagram"></div>
                                                    </div>
                                                </div>
                                                <div class="mt-2 p-2 bg-orange-200 dark:bg-orange-800 rounded-md text-sm font-medium text-orange-800 dark:text-orange-200" data-translate="socket_diagram"></div>
                                                <div class="flex justify-center gap-1 mt-2">
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                    <div class="bg-orange-200 dark:bg-orange-800 p-1 rounded-sm text-xs -rotate-90">RAM</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-4 p-3 bg-orange-500 dark:bg-orange-600 rounded-lg text-center text-white font-semibold" data-translate="motherboard_diagram"></div>
                                    </div>
                                </div>
                                <div class="mt-6 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                                    <p class="font-bold text-yellow-800 dark:text-yellow-200" data-translate="tip_title"></p>
                                    <p data-translate="numa_tip" class="text-sm text-yellow-700 dark:text-yellow-300"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                         <h3 data-translate="sca_schedulers_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6"></h3>
                         <p data-translate="sca_schedulers_desc" class="text-base text-gray-600 dark:text-gray-400 mb-6"></p>
                         <ul class="space-y-4 text-sm">
                             <li class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg"><strong data-translate="sca_default_title" class="text-gray-800 dark:text-gray-200"></strong> <span data-translate="sca_default_desc"></span></li>
                             <li class="p-4 bg-red-100 dark:bg-red-900/50 rounded-lg"><strong data-translate="sca_v1_title" class="text-red-800 dark:text-red-300"></strong> <span data-translate="sca_v1_desc"></span></li>
                             <li class="p-4 bg-amber-100 dark:bg-amber-900/50 rounded-lg"><strong data-translate="sca_v2_title" class="text-amber-800 dark:text-amber-300"></strong> <span data-translate="sca_v2_desc"></span></li>
                         </ul>
                    </div>
                </div>
                 <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 mt-12">
                    <h3 data-translate="glossary_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6"></h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="dark:text-gray-300">
                                <tr>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="glossary_term"></th>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="glossary_layer"></th>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="glossary_definition"></th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 dark:text-gray-400 text-sm">
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700 font-medium" data-translate="pcpu_term"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="hardware_layer"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="pcpu_def"></td>
                                </tr>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700 font-medium" data-translate="lcpu_term"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="hardware_layer"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="lcpu_def"></td>
                                </tr>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700 font-medium" data-translate="vcpu_term"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="hypervisor_layer"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="vcpu_def"></td>
                                </tr>
                                 <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700 font-medium" data-translate="mcpu_term"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="kubernetes_layer"></td>
                                    <td class="p-3 border-b border-gray-200 dark:border-gray-700" data-translate="mcpu_def"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Kubernetes Section -->
            <section id="kubernetes" class="content-section mb-20">
                <div class="text-center mb-16">
                    <h2 data-translate="kubernetes_title" class="text-3xl font-bold text-gray-800 dark:text-white"></h2>
                    <p data-translate="kubernetes_intro" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
                </div>
                <div class="flex flex-col gap-12">
                    <!-- First Row -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 flex flex-col">
                            <h3 data-translate="requests_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                            <div class="flex-grow">
                                <p data-translate="requests_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </div>
                        </div>
                        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 flex flex-col">
                            <h3 data-translate="limits_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                            <div class="flex-grow">
                                <p data-translate="limits_desc" class="text-base text-gray-600 dark:text-gray-400 mb-4"></p>
                                <div class="bg-red-50 dark:bg-red-900/30 border-l-4 border-red-500 p-4 rounded-r-lg">
                                    <p class="font-bold text-red-800 dark:text-red-200" data-translate="throttling_trap_title"></p>
                                    <p data-translate="throttling_trap_desc" class="text-sm text-red-700 dark:text-red-300"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- cgroups mapping -->
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="cgroups_mapping_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="cgroups_mapping_desc" class="text-base text-gray-600 dark:text-gray-400 mb-6"></p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="dark:text-gray-300">
                                    <tr>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="cgroups_k8s_concept"></th>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700">cgroups v1</th>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700">cgroups v2</th>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="cgroups_function"></th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600 dark:text-gray-400 text-sm">
                                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="p-3 font-mono"><code>requests</code></td>
                                        <td class="p-3 font-mono"><code>cpu.shares</code></td>
                                        <td class="p-3 font-mono"><code>cpu.weight</code></td>
                                        <td class="p-3" data-translate="cgroups_requests_func"></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="p-3 font-mono"><code>limits</code></td>
                                        <td class="p-3 font-mono"><code>cpu.cfs_quota_us</code></td>
                                        <td class="p-3 font-mono"><code>cpu.max</code></td>
                                        <td class="p-3" data-translate="cgroups_limits_func"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Visual representation -->
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12 items-center justify-items-center">
                            <!-- CPU Chart -->
                            <div class="w-full max-w-sm">
                                <h4 class="text-center font-semibold text-lg text-gray-800 dark:text-white mb-6">CPU</h4>
                                <div class="grid grid-cols-[100px_1rem_1fr] gap-x-4 h-64 items-center">
                                    <!-- Col 1: Bar -->
                                    <div class="relative h-full w-full bg-gray-200 dark:bg-gray-600 rounded-md overflow-hidden">
                                        <div class="absolute bottom-0 left-0 w-full h-1/3 bg-emerald-400 dark:bg-emerald-600"></div>
                                        <div class="absolute top-0 left-0 w-full h-1/6 bg-orange-400 dark:bg-orange-500"></div>
                                    </div>
                                    <!-- Col 2: Dotted Lines -->
                                    <div class="relative h-full w-full">
                                        <div class="absolute w-full border-t border-dashed border-gray-400 dark:border-gray-500" style="bottom: 33.33%;"></div>
                                        <div class="absolute w-full border-t border-dashed border-gray-400 dark:border-gray-500" style="top: 16.67%;"></div>
                                    </div>
                                    <!-- Col 3: Descriptions -->
                                    <div class="relative h-full">
                                        <div class="absolute text-sm" style="bottom: 33.33%; transform: translateY(50%);">
                                            <p class="font-bold" data-translate="request_label"></p>
                                            <p class="text-gray-600 dark:text-gray-400" data-translate="request_desc_short"></p>
                                        </div>
                                        <div class="absolute text-sm" style="top: 16.67%; transform: translateY(-50%);">
                                            <p class="font-bold" data-translate="limit_label"></p>
                                            <p class="text-gray-600 dark:text-gray-400" data-translate="limit_desc_cpu"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Memory Chart -->
                            <div class="w-full max-w-sm">
                                <h4 class="text-center font-semibold text-lg text-gray-800 dark:text-white mb-6" data-translate="memory_label"></h4>
                                <div class="grid grid-cols-[100px_1rem_1fr] gap-x-4 h-64 items-center">
                                    <!-- Col 1: Bar -->
                                    <div class="relative h-full w-full bg-gray-200 dark:bg-gray-600 rounded-md overflow-hidden">
                                        <div class="absolute bottom-0 left-0 w-full h-1/3 bg-emerald-400 dark:bg-emerald-600"></div>
                                        <div class="absolute top-0 left-0 w-full h-1/6 bg-red-500 dark:bg-red-600"></div>
                                    </div>
                                    <!-- Col 2: Dotted Lines -->
                                    <div class="relative h-full w-full">
                                        <div class="absolute w-full border-t border-dashed border-gray-400 dark:border-gray-500" style="bottom: 33.33%;"></div>
                                        <div class="absolute w-full border-t border-dashed border-gray-400 dark:border-gray-500" style="top: 16.67%;"></div>
                                    </div>
                                    <!-- Col 3: Descriptions -->
                                    <div class="relative h-full">
                                        <div class="absolute text-sm" style="bottom: 33.33%; transform: translateY(50%);">
                                            <p class="font-bold" data-translate="request_label"></p>
                                            <p class="text-gray-600 dark:text-gray-400" data-translate="request_desc_short"></p>
                                        </div>
                                        <div class="absolute text-sm" style="top: 16.67%; transform: translateY(-50%);">
                                            <p class="font-bold" data-translate="limit_label"></p>
                                            <p class="text-gray-600 dark:text-gray-400" data-translate="limit_desc_mem"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Second Row -->
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="qos_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="qos_desc" class="text-base text-gray-600 dark:text-gray-400 mb-6"></p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="dark:text-gray-300">
                                    <tr>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700">QoS</th>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="qos_criteria"></th>
                                        <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="qos_ideal_for"></th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600 dark:text-gray-400 text-sm">
                                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="p-3 font-medium text-blue-700 dark:text-blue-400">Guaranteed</td>
                                        <td class="p-3 font-mono">Requests == Limits</td>
                                        <td class="p-3" data-translate="qos_guaranteed_use_case"></td>
                                    </tr>
                                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="p-3 font-medium text-amber-700 dark:text-amber-400">Burstable</td>
                                        <td class="p-3 font-mono">Requests &lt; Limits</td>
                                        <td class="p-3" data-translate="qos_burstable_use_case"></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="p-3 font-medium text-gray-700 dark:text-gray-300">BestEffort</td>
                                        <td class="p-3" data-translate="qos_besteffort_criteria"></td>
                                        <td class="p-3" data-translate="qos_besteffort_use_case"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                         <div class="mt-6 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                            <p class="font-bold text-yellow-800 dark:text-yellow-200" data-translate="tip_title"></p>
                            <p data-translate="qos_tip" class="text-sm text-yellow-700 dark:text-yellow-300"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Diagnostics Section -->
            <section id="diagnostics" class="content-section mb-20">
                <div class="text-center mb-16">
                    <h2 data-translate="diagnostics_title" class="text-3xl font-bold text-gray-800 dark:text-white"></h2>
                    <p data-translate="diagnostics_intro" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
                </div>
                <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 mb-12">
                    <label for="scenario-selector" class="block text-lg font-medium text-gray-700 dark:text-gray-200 mb-2" data-translate="scenario_selector_label"></label>
                    <select id="scenario-selector" class="block w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 bg-white dark:bg-gray-700">
                        <option value="healthy" data-translate="scenario_healthy"></option>
                        <option value="oversubscribed" data-translate="scenario_oversubscribed"></option>
                        <option value="oversized" data-translate="scenario_oversized"></option>
                        <option value="throttled" data-translate="scenario_throttled"></option>
                    </select>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 text-center">
                        <h3 data-translate="diag_host_contention_title" class="text-xl font-semibold text-gray-800 dark:text-white"></h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Metric: <code>%RDY</code></p>
                        <div class="chart-container h-64">
                            <canvas id="rdyChart"></canvas>
                        </div>
                        <p id="rdy-desc" class="mt-4 text-gray-600 dark:text-gray-400 text-sm min-h-[6rem]"></p>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 text-center">
                        <h3 data-translate="diag_vm_contention_title" class="text-xl font-semibold text-gray-800 dark:text-white"></h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Metric: <code>%CSTP</code></p>
                        <div class="chart-container h-64">
                            <canvas id="cstpChart"></canvas>
                        </div>
                        <p id="cstp-desc" class="mt-4 text-gray-600 dark:text-gray-400 text-sm min-h-[6rem]"></p>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 text-center">
                        <h3 data-translate="diag_pod_contention_title" class="text-xl font-semibold text-gray-800 dark:text-white"></h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Metric: <code>Throttling %</code></p>
                        <div class="chart-container h-64">
                            <canvas id="throttleChart"></canvas>
                        </div>
                        <p id="throttle-desc" class="mt-4 text-gray-600 dark:text-gray-400 text-sm min-h-[6rem]"></p>
                    </div>
                </div>
                <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 mt-12">
                    <h3 data-translate="diag_guide_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6"></h3>
                    
                    <div class="mb-8">
                        <h4 data-translate="diag_workflow_title" class="font-semibold text-lg text-gray-800 dark:text-white mb-4"></h4>
                        <ol class="relative border-l border-gray-200 dark:border-gray-700 space-y-6 ml-4">
                            <li class="ml-8">
                                <span class="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900 text-blue-800 dark:text-blue-300">1</span>
                                <p data-translate="diag_workflow_step1" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </li>
                            <li class="ml-8">
                                <span class="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900 text-blue-800 dark:text-blue-300">2</span>
                                <p data-translate="diag_workflow_step2" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </li>
                            <li class="ml-8">
                                <span class="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900 text-blue-800 dark:text-blue-300">3</span>
                                <p data-translate="diag_workflow_step3" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </li>
                            <li class="ml-8">
                                <span class="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900 text-blue-800 dark:text-blue-300">4</span>
                                <p data-translate="diag_workflow_step4" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </li>
                        </ol>
                    </div>

                    <div class="bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-4 rounded-r-lg mb-6">
                        <p class="font-bold text-yellow-800 dark:text-yellow-200" data-translate="node_metrics_warning_title"></p>
                        <p data-translate="node_metrics_warning_desc" class="text-sm text-yellow-700 dark:text-yellow-300"></p>
                    </div>
                    <div class="mb-6">
                        <h4 data-translate="prometheus_monitoring_title" class="font-semibold text-gray-800 dark:text-white mb-2"></h4>
                        <p data-translate="prometheus_monitoring_desc" class="text-sm text-gray-600 dark:text-gray-400 mb-4"></p>
                        <pre class="bg-gray-100 dark:bg-gray-900 rounded-md overflow-x-auto p-4 text-sm"><code class="language-promql">rate(container_cpu_cfs_throttled_periods_total[5m]) / rate(container_cpu_cfs_periods_total[5m]) * 100</code></pre>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="dark:text-gray-300">
                                <tr>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="diag_table_metric"></th>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="diag_table_layer"></th>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="diag_table_cause"></th>
                                    <th class="p-3 text-sm font-semibold border-b-2 border-gray-200 dark:border-gray-700" data-translate="diag_table_threshold"></th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 dark:text-gray-400 text-sm">
                                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 font-mono"><code>%RDY</code></td>
                                    <td class="p-3">vSphere</td>
                                    <td class="p-3" data-translate="diag_table_rdy_cause"></td>
                                    <td class="p-3 font-mono">&lt; 5-10% per vCPU</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 font-mono"><code>%CSTP</code></td>
                                    <td class="p-3">vSphere</td>
                                    <td class="p-3" data-translate="diag_table_cstp_cause"></td>
                                    <td class="p-3 font-mono">&lt; 3%</td>
                                </tr>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="p-3 font-mono"><code>Throttling</code></td>
                                    <td class="p-3">Kubernetes</td>
                                    <td class="p-3" data-translate="diag_table_throttle_cause"></td>
                                    <td class="p-3" data-translate="diag_table_throttle_threshold"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Strategies Section -->
            <section id="strategies" class="content-section mb-20">
                <div class="text-center mb-16">
                    <h2 data-translate="strategies_title" class="text-3xl font-bold text-gray-800 dark:text-white"></h2>
                    <p data-translate="strategies_intro" class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"></p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="strat_rightsizing_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="strat_rightsizing_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8 lg:col-span-2">
                        <h3 data-translate="strat_limits_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-6"></h3>
                        <div class="grid md:grid-cols-2 gap-x-8 gap-y-6">
                            <div>
                                <h4 data-translate="strat_limits_avoid_title" class="font-semibold text-lg text-red-700 dark:text-red-400 mb-2"></h4>
                                <p data-translate="strat_limits_avoid_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </div>
                            <div class="border-t md:border-t-0 md:border-l border-gray-200 dark:border-gray-700 pt-6 md:pt-0 md:pl-8">
                                 <h4 data-translate="strat_limits_use_title" class="font-semibold text-lg text-green-700 dark:text-green-400 mb-2"></h4>
                                <p data-translate="strat_limits_use_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="strat_isolate_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="strat_isolate_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                    </div>
                    <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="strat_pinning_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="strat_pinning_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                    </div>
                     <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg p-8">
                        <h3 data-translate="strat_profiling_title" class="text-xl font-semibold text-gray-800 dark:text-white mb-4"></h3>
                        <p data-translate="strat_profiling_desc" class="text-base text-gray-600 dark:text-gray-400"></p>
                        <div class="flex items-center justify-center mt-4 p-4 bg-gray-100 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 min-h-[8rem]">
                            <p class="text-gray-500 dark:text-gray-400 text-sm" data-translate="flame_graph_placeholder"></p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center py-12 mt-8 border-t border-gray-200 dark:border-gray-700">
            <p data-translate="footer_text" class="text-sm text-gray-500 dark:text-gray-400"></p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- TRANSLATION DATA ---
            const translations = {
                es: {
                    main_title: "Del silicio al pod",
                    main_subtitle: "Gu√≠a pr√°ctica de rendimiento de CPU en Kubernetes virtualizado",
                    nav_hardware: "Capa 1: hardware",
                    nav_hypervisor: "Capa 2: hipervisor",
                    nav_kubernetes: "Capa 3: Kubernetes",
                    nav_diagnostics: "Capa 4: diagn√≥stico",
                    nav_strategies: "Capa 5: estrategias",
                    hardware_title: "La base f√≠sica",
                    hardware_intro: "Todo an√°lisis de rendimiento comienza en el hardware. Esta secci√≥n desglosa la arquitectura de un n√∫cleo de CPU, comparando un dise√±o est√°ndar con uno que utiliza Multithreading Simult√°neo (SMT o Hyper-Threading), para sentar las bases de c√≥mo se gestionan los recursos a nivel f√≠sico.",
                    core_no_smt_title: "Anatom√≠a de un n√∫cleo est√°ndar (sin SMT)",
                    physical_core: "N√∫cleo f√≠sico",
                    architectural_state: "Estado arquitect√≥nico",
                    single_thread: "Hilo l√≥gico √∫nico",
                    execution_units: "Unidades de ejecuci√≥n",
                    core_no_smt_desc: "Representa la arquitectura tradicional donde un n√∫cleo f√≠sico procesa un √∫nico hilo de ejecuci√≥n a la vez. Ofrece un rendimiento predecible y sin contenci√≥n interna, pero puede resultar ineficiente si el hilo se detiene a la espera de datos, dejando las unidades de ejecuci√≥n inactivas.",
                    core_smt_title: "Anatom√≠a de un n√∫cleo con Hyper-Threading (SMT)",
                    arch_state_duplicated: "Estado arquitect√≥nico (duplicado)",
                    logical_thread_1: "Hilo l√≥gico 1",
                    logical_thread_2: "Hilo l√≥gico 2",
                    arch_state_tooltip: "Se duplica para cada hilo, permitiendo al SO ver dos procesadores l√≥gicos. Incluye los registros y el contador de programa.",
                    exec_units_shared: "Unidades de ejecuci√≥n (compartidas)",
                    exec_units_tooltip: "Son los 'm√∫sculos' de la CPU. Se comparten entre los hilos l√≥gicos, lo que puede causar esperas y problemas de seguridad.",
                    core_smt_desc: "Utiliza un √∫nico conjunto de unidades de ejecuci√≥n para procesar dos hilos l√≥gicos simult√°neamente. Esto mejora la utilizaci√≥n de los recursos, pero introduce la posibilidad de contenci√≥n y ha sido el origen de vulnerabilidades de seguridad.",
                    execution_flow_no_smt_title: "Flujo de Ejecuci√≥n Sin SMT",
                    execution_flow_no_smt_desc: "Las pausas en un hilo (stalls) dejan los recursos del n√∫cleo inactivos.",
                    execution_flow_smt_title: "Flujo de Ejecuci√≥n Con SMT",
                    execution_flow_smt_desc: "SMT intercala instrucciones de un segundo hilo para maximizar la utilizaci√≥n.",
                    ht_benefit_title: "El beneficio real del Hyper-Threading",
                    ht_benefit_desc: "HT no duplica el rendimiento. La ganancia (15-30%) depende del tipo de trabajo. Puedes simularlo aqu√≠:",
                    workload_type: "Tipo de carga",
                    workload_label_mixed: "Mixta",
                    workload_label_low: "Baja (I/O intensivo)",
                    workload_label_high: "Alta (Multihilo Diverso)",
                    ht_chart_title: "Ganancia de Rendimiento con Hyper-Threading",
                    ht_chart_label_single: "N√∫cleo F√≠sico √önico",
                    ht_chart_label_ht: "Mismo N√∫cleo con HT",
                    ht_chart_dataset_label: "Rendimiento Relativo",
                    security_risks_title: "Riesgos de seguridad",
                    security_risks_desc: "Al compartir recursos, HT crea riesgos. Vulnerabilidades como <strong>L1TF</strong> y <strong>MDS</strong> explotan la cach√© L1 compartida, permitiendo a un hilo malicioso espiar datos de su hilo vecino.",
                    tip_title: "Consejo pr√°ctico:",
                    security_risks_tip: "Por estos riesgos, los hipervisores tienen planificadores (SCA) que pueden limitar o desactivar HT, creando un dilema entre seguridad y rendimiento.",
                    hypervisor_title: "La capa de virtualizaci√≥n",
                    hypervisor_intro: "El hipervisor es la capa de abstracci√≥n que se asienta sobre el hardware. Analizaremos c√≥mo el planificador de CPU de VMware ESXi interpreta la arquitectura f√≠sica (incluyendo SMT y NUMA) para asignar CPUs virtuales (vCPUs) a las m√°quinas virtuales, tomando decisiones clave que impactan directamente en el rendimiento.",
                    esxi_scheduler_title: "L√≥gica del planificador de ESXi",
                    golden_rule_title: "Regla de oro: priorizar n√∫cleos f√≠sicos",
                    golden_rule_desc: "El planificador prioriza asignar vCPUs a n√∫cleos f√≠sicos desocupados antes de usar hilos l√≥gicos (HT). Esto evita la competencia por recursos compartidos como la cach√© y las unidades de ejecuci√≥n, maximizando el rendimiento.",
                    relaxed_cosched_title: "Co-planificaci√≥n relajada",
                    relaxed_cosched_desc: "ESXi no exige que todas las vCPUs de una VM se ejecuten simult√°neamente, permitiendo un peque√±o desfase (`skew`). Esto mejora la eficiencia y reduce la espera (**%RDY**). Un **%CSTP** alto (>3%) indica que la VM tiene demasiadas vCPUs y el planificador tiene dificultades para coordinarlas.",
                    cpu_resources_title: "Recursos de CPU: Reservas y Shares",
                    cpu_resources_desc: "ESXi gestiona la prioridad con <strong>Shares</strong>, que asignan un peso relativo a cada VM durante la contenci√≥n de CPU, y <strong>Reservas</strong>, que garantizan un m√≠nimo de MHz pero son menos flexibles y se usan con menos frecuencia.",
                    numa_title: "Gesti√≥n de NUMA y vNUMA",
                    numa_desc: "En servidores con m√∫ltiples sockets, el acceso a la memoria local de un procesador (nodo NUMA) es m√°s r√°pido que a la memoria remota. ESXi expone una topolog√≠a virtual (vNUMA) para que el sistema operativo de la VM pueda optimizar la localizaci√≥n de memoria y evitar la latencia de los accesos remotos.",
                    server_diagram_title: "Servidor",
                    numa_node_diagram: "Nodo NUMA",
                    processor_package_diagram: "Paquete de procesador",
                    core_diagram: "Core",
                    socket_diagram: "Socket",
                    motherboard_diagram: "Placa base",
                    numa_tip: "Una mala configuraci√≥n de vNUMA es un error grave de rendimiento. Intenta siempre que las VMs quepan en un solo nodo NUMA f√≠sico.",
                    sca_schedulers_title: "Planificadores SCA",
                    sca_schedulers_desc: "Para reducir los riesgos de seguridad de HT, VMware ofrece estos planificadores:",
                    sca_default_title: "Predeterminado:",
                    sca_default_desc: "M√°ximo rendimiento. Asume que las cargas de trabajo son de confianza y no a√≠sla los hilos hermanos, permitiendo que diferentes VMs compartan el mismo n√∫cleo f√≠sico. Es la opci√≥n m√°s eficiente si la seguridad no es la m√°xima prioridad.",
                    sca_v1_title: "SCAv1:",
                    sca_v1_desc: "M√°xima seguridad. Impide por completo que vCPUs de VMs diferentes compartan el mismo n√∫cleo, eliminando el riesgo de ataques de canal lateral a costa de un rendimiento significativamente menor.",
                    sca_v2_title: "SCAv2:",
                    sca_v2_desc: "Equilibrio. Permite que vCPUs de la *misma VM* compartan un n√∫cleo, pero no entre VMs diferentes. Ofrece una mejora de seguridad sobre la opci√≥n predeterminada sin sacrificar tanto rendimiento como SCAv1.",
                    glossary_title: "Glosario de t√©rminos de CPU",
                    glossary_term: "T√©rmino",
                    glossary_layer: "Capa",
                    glossary_definition: "Definici√≥n",
                    pcpu_term: "N√∫cleo f√≠sico (pCPU)",
                    hardware_layer: "Hardware",
                    pcpu_def: "Unidad de procesamiento f√≠sica. La base del c√≥mputo.",
                    lcpu_term: "N√∫cleo l√≥gico (hilo HT)",
                    lcpu_def: "Un hilo de ejecuci√≥n. Ofrece un 15-30% m√°s de rendimiento, pero puede haber esperas.",
                    vcpu_term: "CPU virtual (vCPU)",
                    hypervisor_layer: "Hipervisor",
                    vcpu_def: "Una abstracci√≥n de software que ESXi asigna a un n√∫cleo l√≥gico disponible.",
                    mcpu_term: "Unidad de CPU (mCPU)",
                    kubernetes_layer: "Kubernetes",
                    mcpu_def: "Unidad de medida. `1000m` equivale a 1 vCPU. Se traduce en `cpu.shares` o `cpu.cfs_quota`.",
                    kubernetes_title: "La orquestaci√≥n de contenedores",
                    kubernetes_intro: "Sobre la capa de virtualizaci√≥n, Kubernetes introduce su propio modelo de gesti√≥n de recursos. Esta secci√≥n explica en detalle los conceptos de `requests` y `limits`, c√≥mo se traducen a los cgroups del kernel de Linux (tanto v1 como v2), y c√≥mo definen la calidad de servicio (QoS) de las aplicaciones.",
                    requests_title: "Requests: garant√≠a proporcional",
                    requests_desc: "Garantiza una porci√≥n del tiempo de CPU cuando hay competencia. Su funci√≥n principal es informar al planificador de Kubernetes para ubicar los pods.",
                    limits_title: "Limits: un techo r√≠gido y peligroso",
                    limits_desc: "Es un tope absoluto. Si un pod consume su cuota de CPU en un periodo de 100ms, el kernel lo **estrangula (throttles)**, pausando su ejecuci√≥n, incluso si hay CPUs libres.",
                    throttling_trap_title: "‚ö†Ô∏è La trampa del throttling",
                    throttling_trap_desc: "Este es el 'asesino silencioso' del rendimiento. Causa picos de latencia y es la raz√≥n principal para evitar los l√≠mites de CPU en aplicaciones importantes.",
                    cgroups_mapping_title: "Mapeo a cgroups: v1 vs. v2",
                    cgroups_mapping_desc: "Kubernetes traduce las requests y limits a diferentes ficheros de control del kernel dependiendo de la versi√≥n de cgroups del nodo.",
                    cgroups_k8s_concept: "Concepto K8s",
                    cgroups_function: "Funci√≥n",
                    cgroups_requests_func: "Peso relativo durante la contenci√≥n.",
                    cgroups_limits_func: "L√≠mite m√°ximo de tiempo de CPU por periodo.",
                    request_label: "Request:",
                    request_desc_short: "Cantidad garantizada",
                    limit_label: "Limit:",
                    limit_desc_cpu: "Donde empieza el throttling",
                    memory_label: "Memoria",
                    limit_desc_mem: "Donde empiezan las expulsiones (OOM)",
                    qos_title: "Clases de calidad de servicio (QoS)",
                    qos_desc: "La relaci√≥n entre requests y limits define la clase de QoS de un pod, lo que afecta a su prioridad.",
                    qos_criteria: "Criterio",
                    qos_ideal_for: "Ideal para",
                    qos_guaranteed_use_case: "Bases de datos, cargas cr√≠ticas.",
                    qos_burstable_use_case: "APIs, servidores web (recomendado).",
                    qos_besteffort_criteria: "Sin Requests/Limits",
                    qos_besteffort_use_case: "Jobs no cr√≠ticos, desarrollo.",
                    qos_tip: "Para la mayor√≠a de las aplicaciones, usa la clase <strong>Burstable</strong>: define una `request` de CPU precisa y <strong>no pongas</strong> un `limit`. Esto da un buen rendimiento y permite picos de uso sin riesgo de throttling.",
                    diagnostics_title: "Panel de diagn√≥stico",
                    diagnostics_intro: "Saber d√≥nde mirar es clave para resolver problemas. Este panel de diagn√≥stico interactivo te permite simular escenarios comunes de contenci√≥n de CPU. Aprender√°s a interpretar las m√©tricas clave de cada capa (`%RDY`, `%CSTP`, `throttling`) para identificar r√°pidamente la causa ra√≠z de un problema de rendimiento.",
                    scenario_selector_label: "Selecciona un escenario de problema:",
                    scenario_healthy: "‚úÖ Sistema saludable",
                    scenario_oversubscribed: "üìâ Host sobrescrito (demasiadas VMs)",
                    scenario_oversized: " bloated VM (demasiadas vCPUs)",
                    scenario_throttled: "üõë Pod estrangulado (l√≠mite de CPU bajo)",
                    diag_host_contention_title: "Contenci√≥n de hipervisor (host)",
                    diag_vm_contention_title: "Contenci√≥n de hipervisor (VM)",
                    diag_pod_contention_title: "Contenci√≥n de Kubernetes (pod)",
                    rdy_desc_healthy: "Un valor bajo es saludable. El host tiene capacidad de CPU de sobra.",
                    cstp_desc_healthy: "Un valor bajo es saludable. Las VMs tienen un tama√±o adecuado.",
                    throttle_desc_healthy: "Un valor de cero es ideal. Los pods no est√°n siendo estrangulados por sus l√≠mites.",
                    rdy_desc_oversubscribed: "¬°ALTO! El host est√° sobrecargado. Demasiadas VMs activas compiten por los n√∫cleos f√≠sicos, causando esperas.",
                    cstp_desc_oversubscribed: "Normal. El problema no es el tama√±o individual de las VMs, sino la cantidad total de carga en el host.",
                    throttle_desc_oversubscribed: "Normal. El problema est√° en la capa del hipervisor, no en los l√≠mites de Kubernetes.",
                    rdy_desc_oversized: "Normal. El host tiene capacidad. La espera no es un problema.",
                    cstp_desc_oversized: "¬°ALTO! La VM tiene demasiadas vCPUs para su carga, causando sobrecoste de co-planificaci√≥n.",
                    throttle_desc_oversized: "Normal. El problema est√° en la configuraci√≥n de la VM, no en los l√≠mites del pod.",
                    rdy_desc_throttled: "Normal. El host y la VM est√°n bien, hay recursos f√≠sicos disponibles.",
                    cstp_desc_throttled: "Normal. La VM tiene un tama√±o adecuado para su carga.",
                    throttle_desc_throttled: "¬°ALTO! El pod est√° siendo estrangulado por un l√≠mite de CPU demasiado bajo, causando latencia artificial.",
                    diag_guide_title: "Gu√≠a de diagn√≥stico r√°pido",
                    diag_workflow_title: "Flujo de trabajo para el diagn√≥stico de lentitud",
                    diag_workflow_step1: "<strong>Capa de Kubernetes (Pod):</strong> Empieza siempre aqu√≠. Revisa las m√©tricas de `CPU Throttling` del pod. Si hay throttling, el problema es casi siempre un l√≠mite de CPU demasiado bajo. Aumenta el l√≠mite o elim√≠nalo. Si no hay throttling, pasa al siguiente nivel.",
                    diag_workflow_step2: "<strong>Capa de Hipervisor (VM):</strong> Si el pod no est√° estrangulado, revisa las m√©tricas de la VM en vSphere. Un `%CSTP` alto (>3%) indica que la VM tiene demasiadas vCPUs. Reduce el n√∫mero de vCPUs de la VM (y ajusta las `requests` del pod en consecuencia).",
                    diag_workflow_step3: "<strong>Capa de Hipervisor (Host):</strong> Si `%CSTP` es bajo, revisa el `%RDY`. Un `%RDY` alto (>5-10%) significa que el host ESXi est√° sobrecargado de CPU y las VMs est√°n esperando para ser planificadas. La soluci√≥n es migrar VMs a otros hosts o a√±adir m√°s capacidad.",
                    diag_workflow_step4: "<strong>Capa de Aplicaci√≥n (C√≥digo):</strong> Si ninguna de las m√©tricas de infraestructura anteriores muestra problemas, la causa ra√≠z probablemente est√© en el propio c√≥digo de la aplicaci√≥n. Utiliza herramientas de perfilado para encontrar cuellos de botella.",
                    node_metrics_warning_title: "¬°Cuidado con las m√©tricas del nodo!",
                    node_metrics_warning_desc: "La utilizaci√≥n de CPU de un nodo puede ser baja (ej. 20%), pero los pods dentro de √©l pueden estar sufriendo un alto throttling y picos de latencia. Siempre revisa las m√©tricas de throttling a nivel de pod, no solo la CPU del nodo.",
                    prometheus_monitoring_title: "Monitorizando el throttling con Prometheus",
                    prometheus_monitoring_desc: "Para calcular el porcentaje de throttling de un contenedor, puedes usar la siguiente consulta en PromQL. Mide la proporci√≥n de periodos en los que el contenedor fue estrangulado frente al total de periodos.",
                    diag_table_metric: "M√©trica",
                    diag_table_layer: "Capa",
                    diag_table_cause: "Causa ra√≠z probable",
                    diag_table_threshold: "Umbral",
                    diag_table_rdy_cause: "Sobrescripci√≥n de CPU a nivel de host.",
                    diag_table_cstp_cause: "VM sobredimensionada (demasiadas vCPUs).",
                    diag_table_throttle_cause: "L√≠mite de CPU del pod demasiado bajo. Causa picos de latencia incluso en un nodo con CPU libre.",
                    diag_table_throttle_threshold: "Cero (para apps sensibles)",
                    strategies_title: "Estrategias de optimizaci√≥n",
                    strategies_intro: "Una vez diagnosticado el problema, se necesita una soluci√≥n. Esta secci√≥n final ofrece un conjunto de estrategias y mejores pr√°cticas, desde el ajuste fundamental de recursos (right-sizing) hasta t√©cnicas avanzadas como el aislamiento de cargas y la fijaci√≥n de CPU, para optimizar el rendimiento de tus aplicaciones en producci√≥n.",
                    strat_rightsizing_title: "1. Ajuste continuo (right-sizing)",
                    strat_rightsizing_desc: "Alinea los recursos asignados con el uso real. Para las `requests` de CPU, un buen punto de partida es usar el percentil 95 (p95) del uso hist√≥rico. Usa <strong>VPA</strong> en modo recomendaci√≥n para obtener estas cifras.",
                    strat_limits_title: "2. La gesti√≥n de l√≠mites de CPU: ¬øcu√°ndo y cu√°ndo no?",
                    strat_limits_avoid_title: "Evitar l√≠mites (regla general)",
                    strat_limits_avoid_desc: "Para servicios sensibles a la latencia (APIs, frontends), <strong>no establezcas l√≠mites de CPU</strong>. Conf√≠a en `requests` bien ajustadas para permitir picos de uso sin el riesgo de throttling.",
                    strat_limits_use_title: "Usar l√≠mites (excepciones)",
                    strat_limits_use_desc: "Los l√≠mites pueden ser √∫tiles para trabajos no cr√≠ticos (ej. batch, ETL) donde un rendimiento predecible no es la prioridad, pero s√≠ lo es limitar el consumo de recursos para no afectar a otros servicios.",
                    strat_isolate_title: "3. Aislar cargas de trabajo",
                    strat_isolate_desc: "Usa `Namespaces` con `ResourceQuotas` para establecer l√≠mites de consumo por equipo. Para un aislamiento f√≠sico m√°s estricto, dedica nodos espec√≠ficos a ciertas cargas de trabajo mediante `Taints` y `Tolerations` o `Node Affinity`. Esto evita que aplicaciones no cr√≠ticas (batch) compitan por recursos con servicios sensibles a la latencia (APIs), un fen√≥meno conocido como 'vecino ruidoso'.",
                    strat_pinning_title: "4. Fijaci√≥n de CPU (avanzado)",
                    strat_pinning_desc: "Para cargas de trabajo de ultra baja latencia (ej. trading de alta frecuencia, telecomunicaciones), usa la pol√≠tica `static` del <strong>CPU Manager</strong> de Kubernetes. Esto asigna n√∫cleos de CPU exclusivos a los contenedores de un pod, eliminando el 'jitter' (variabilidad de latencia) causado por el cambio de contexto del planificador. El coste es una menor densidad de pods por nodo, ya que los n√∫cleos asignados no pueden ser compartidos.",
                    strat_profiling_title: "5. Perfilar la aplicaci√≥n",
                    strat_profiling_desc: "Si las m√©tricas de la infraestructura est√°n bien, el problema puede estar en el c√≥digo. Usa `kubectl top` y herramientas de perfilado continuo (ej. <strong>Parca, Pyroscope</strong>) para encontrar cuellos de botella en el c√≥digo.",
                    flame_graph_placeholder: "[Ejemplo de un gr√°fico de llama (flame graph) para perfilar CPU]",
                    footer_text: "Gu√≠a interactiva para facilitar la comprensi√≥n de conceptos complejos de rendimiento."
                },
                en: {
                    main_title: "From Silicon to Pod",
                    main_subtitle: "A Practical Guide to CPU Performance in Virtualized Kubernetes",
                    nav_hardware: "Layer 1: Hardware",
                    nav_hypervisor: "Layer 2: Hypervisor",
                    nav_kubernetes: "Layer 3: Kubernetes",
                    nav_diagnostics: "Layer 4: Diagnostics",
                    nav_strategies: "Layer 5: Strategies",
                    hardware_title: "The Physical Foundation",
                    hardware_intro: "All performance analysis begins with the hardware. This section breaks down the architecture of a CPU core, comparing a standard design with one that uses Simultaneous Multithreading (SMT or Hyper-Threading), to establish the basics of how resources are managed at the physical level.",
                    core_no_smt_title: "Anatomy of a Standard Core (No SMT)",
                    physical_core: "Physical Core",
                    architectural_state: "Architectural State",
                    single_thread: "Single Logical Thread",
                    execution_units: "Execution Units",
                    core_no_smt_desc: "Represents the traditional architecture where one physical core processes a single thread of execution at a time. It offers predictable performance without internal contention but can be inefficient if the thread stalls waiting for data, leaving execution units idle.",
                    core_smt_title: "Anatomy of a Hyper-Threaded Core (SMT)",
                    arch_state_duplicated: "Architectural State (Duplicated)",
                    logical_thread_1: "Logical Thread 1",
                    logical_thread_2: "Logical Thread 2",
                    arch_state_tooltip: "This is duplicated for each thread, allowing the OS to see two logical processors. It includes registers and the program counter.",
                    exec_units_shared: "Execution Units (Shared)",
                    exec_units_tooltip: "These are the 'muscles' of the CPU. They are shared between logical threads, which can cause stalls and security issues.",
                    core_smt_desc: "Uses a single set of execution units to process two logical threads simultaneously. This improves resource utilization but introduces the potential for contention and has been the source of security vulnerabilities.",
                    execution_flow_no_smt_title: "Execution Flow Without SMT",
                    execution_flow_no_smt_desc: "Pauses in a thread (stalls) leave the core's resources idle.",
                    execution_flow_smt_title: "Execution Flow With SMT",
                    execution_flow_smt_desc: "SMT interleaves instructions from a second thread to maximize utilization.",
                    ht_benefit_title: "The Real Benefit of Hyper-Threading",
                    ht_benefit_desc: "HT doesn't double the performance. The gain (15-30%) depends on the workload. You can simulate it here:",
                    workload_type: "Workload Type",
                    workload_label_mixed: "Mixed",
                    workload_label_low: "Low (I/O Intensive)",
                    workload_label_high: "High (Diverse Multithreading)",
                    ht_chart_title: "Performance Gain with Hyper-Threading",
                    ht_chart_label_single: "Single Physical Core",
                    ht_chart_label_ht: "Same Core with HT",
                    ht_chart_dataset_label: "Relative Performance",
                    security_risks_title: "Security Risks",
                    security_risks_desc: "By sharing resources, HT creates risks. Vulnerabilities like <strong>L1TF</strong> and <strong>MDS</strong> exploit the shared L1 cache, allowing a malicious thread to spy on data from its sibling thread.",
                    tip_title: "Practical Tip:",
                    security_risks_tip: "Due to these risks, hypervisors have schedulers (SCA) that can limit or disable HT, creating a trade-off between security and performance.",
                    hypervisor_title: "The Virtualization Layer",
                    hypervisor_intro: "The hypervisor is the abstraction layer that sits on top of the hardware. We will analyze how the VMware ESXi CPU scheduler interprets the physical architecture (including SMT and NUMA) to assign virtual CPUs (vCPUs) to virtual machines, making key decisions that directly impact performance.",
                    esxi_scheduler_title: "ESXi Scheduler Logic",
                    golden_rule_title: "Golden Rule: Prioritize Physical Cores",
                    golden_rule_desc: "The scheduler prioritizes assigning vCPUs to unoccupied physical cores before using logical threads (HT). This avoids contention for shared resources like the cache and execution units, maximizing performance.",
                    relaxed_cosched_title: "Relaxed Co-scheduling",
                    relaxed_cosched_desc: "ESXi doesn't require all of a VM's vCPUs to run simultaneously, allowing a slight `skew`. This improves efficiency and reduces wait time (**%RDY**). A high **%CSTP** (>3%) indicates the VM has too many vCPUs for the scheduler to coordinate effectively.",
                    cpu_resources_title: "CPU Resources: Reservations and Shares",
                    cpu_resources_desc: "ESXi manages priority with <strong>Shares</strong>, which assign a relative weight to each VM during CPU contention, and <strong>Reservations</strong>, which guarantee a minimum MHz but are less flexible and used less often.",
                    numa_title: "NUMA and vNUMA Management",
                    numa_desc: "On multi-socket servers, accessing a processor's local memory (NUMA node) is faster than remote memory. ESXi exposes a virtual topology (vNUMA) so the VM's operating system can optimize memory locality and avoid the latency of remote access.",
                    server_diagram_title: "Server",
                    numa_node_diagram: "NUMA Node",
                    processor_package_diagram: "Processor Package",
                    core_diagram: "Core",
                    socket_diagram: "Socket",
                    motherboard_diagram: "Motherboard",
                    numa_tip: "A poor vNUMA configuration is a critical performance mistake. Always try to size VMs to fit within a single physical NUMA node.",
                    sca_schedulers_title: "SCA Schedulers",
                    sca_schedulers_desc: "To mitigate HT security risks, VMware offers these schedulers:",
                    sca_default_title: "Default:",
                    sca_default_desc: "Maximum performance. Assumes workloads are trusted and does not isolate sibling threads, allowing different VMs to share the same physical core. It's the most efficient option if security is not the top priority.",
                    sca_v1_title: "SCAv1:",
                    sca_v1_desc: "Maximum security. It completely prevents vCPUs from different VMs from sharing the same core, eliminating the risk of side-channel attacks at the cost of significantly lower performance.",
                    sca_v2_title: "SCAv2:",
                    sca_v2_desc: "Balanced. Allows vCPUs from the *same VM* to share a core, but not between different VMs. It offers a security improvement over the default option without sacrificing as much performance as SCAv1.",
                    glossary_title: "CPU Terms Glossary",
                    glossary_term: "Term",
                    glossary_layer: "Layer",
                    glossary_definition: "Definition",
                    pcpu_term: "Physical Core (pCPU)",
                    hardware_layer: "Hardware",
                    pcpu_def: "A physical processing unit. The foundation of computation.",
                    lcpu_term: "Logical Core (HT Thread)",
                    lcpu_def: "An execution thread. Offers 15-30% more performance, but can introduce stalls.",
                    vcpu_term: "Virtual CPU (vCPU)",
                    hypervisor_layer: "Hypervisor",
                    vcpu_def: "A software abstraction that ESXi maps to an available logical core.",
                    mcpu_term: "CPU Unit (mCPU)",
                    kubernetes_layer: "Kubernetes",
                    mcpu_def: "A unit of measure. `1000m` equals 1 vCPU. Translates to `cpu.shares` or `cpu.cfs_quota`.",
                    kubernetes_title: "Container Orchestration",
                    kubernetes_intro: "On top of the virtualization layer, Kubernetes introduces its own resource management model. This section explains in detail the concepts of `requests` and `limits`, how they translate to Linux kernel cgroups (both v1 and v2), and how they define the Quality of Service (QoS) for applications.",
                    requests_title: "Requests: Proportional Guarantee",
                    requests_desc: "Guarantees a share of CPU time during contention. Its main purpose is to inform the Kubernetes scheduler for pod placement.",
                    limits_title: "Limits: A Hard and Dangerous Ceiling",
                    limits_desc: "This is an absolute cap. If a pod uses its CPU quota within a 100ms period, the kernel **throttles** it, pausing its execution, even if there are idle CPUs.",
                    throttling_trap_title: "‚ö†Ô∏è The Throttling Trap",
                    throttling_trap_desc: "This is the 'silent killer' of performance. It causes latency spikes and is the main reason to avoid CPU limits on important applications.",
                    cgroups_mapping_title: "Mapping to cgroups: v1 vs. v2",
                    cgroups_mapping_desc: "Kubernetes translates requests and limits into different kernel control files depending on the node's cgroups version.",
                    cgroups_k8s_concept: "K8s Concept",
                    cgroups_function: "Function",
                    cgroups_requests_func: "Relative weight during contention.",
                    cgroups_limits_func: "Maximum CPU time per period.",
                    request_label: "Request:",
                    request_desc_short: "Guaranteed amount",
                    limit_label: "Limit:",
                    limit_desc_cpu: "Where throttling begins",
                    memory_label: "Memory",
                    limit_desc_mem: "Where evictions (OOM) begin",
                    qos_title: "Quality of Service (QoS) Classes",
                    qos_desc: "The relationship between requests and limits defines a pod's QoS class, which affects its priority.",
                    qos_criteria: "Criteria",
                    qos_ideal_for: "Ideal For",
                    qos_guaranteed_use_case: "Databases, critical workloads.",
                    qos_burstable_use_case: "APIs, web servers (recommended).",
                    qos_besteffort_criteria: "No Requests/Limits",
                    qos_besteffort_use_case: "Non-critical jobs, development.",
                    qos_tip: "For most applications, use the <strong>Burstable</strong> class: set a precise CPU `request` and do <strong>not</strong> set a `limit`. This provides good performance and allows for usage spikes without the risk of throttling.",
                    diagnostics_title: "Diagnostics Dashboard",
                    diagnostics_intro: "Knowing where to look is key to solving problems. This interactive diagnostic panel lets you simulate common CPU contention scenarios. You will learn to interpret key metrics from each layer (`%RDY`, `%CSTP`, `throttling`) to quickly identify the root cause of a performance issue.",
                    scenario_selector_label: "Select a problem scenario:",
                    scenario_healthy: "‚úÖ Healthy System",
                    scenario_oversubscribed: "üìâ Oversubscribed Host (too many VMs)",
                    scenario_oversized: " Bloated VM (too many vCPUs)",
                    scenario_throttled: "üõë Throttled Pod (low CPU limit)",
                    diag_host_contention_title: "Hypervisor Contention (Host)",
                    diag_vm_contention_title: "Hypervisor Contention (VM)",
                    diag_pod_contention_title: "Kubernetes Contention (Pod)",
                    rdy_desc_healthy: "A low value is healthy. The host has plenty of spare CPU capacity.",
                    cstp_desc_healthy: "A low value is healthy. The VMs are appropriately sized.",
                    throttle_desc_healthy: "A value of zero is ideal. Pods are not being throttled by their limits.",
                    rdy_desc_oversubscribed: "HIGH! The host is overloaded. Too many active VMs are competing for physical cores, causing waits.",
                    cstp_desc_oversubscribed: "Normal. The issue is not the individual VM size, but the total load on the host.",
                    throttle_desc_oversubscribed: "Normal. The problem is at the hypervisor layer, not with Kubernetes limits.",
                    rdy_desc_oversized: "Normal. The host has capacity. Waiting is not an issue.",
                    cstp_desc_oversized: "HIGH! The VM has too many vCPUs for its workload, causing co-scheduling overhead.",
                    throttle_desc_oversized: "Normal. The problem is with the VM configuration, not the pod's limits.",
                    rdy_desc_throttled: "Normal. The host and VM are fine; there are available physical resources.",
                    cstp_desc_throttled: "Normal. The VM is appropriately sized for its load.",
                    throttle_desc_throttled: "HIGH! The pod is being throttled by a CPU limit that is too low, causing artificial latency.",
                    diag_guide_title: "Quick Diagnostics Guide",
                    diag_workflow_title: "Troubleshooting Workflow for Slowness",
                    diag_workflow_step1: "<strong>Kubernetes Layer (Pod):</strong> Always start here. Check the pod's `CPU Throttling` metrics. If throttling is present, the problem is almost always a CPU limit that is too low. Increase the limit or remove it. If there's no throttling, move to the next level.",
                    diag_workflow_step2: "<strong>Hypervisor Layer (VM):</strong> If the pod isn't throttled, check the VM's metrics in vSphere. A high `%CSTP` (>3%) indicates the VM has too many vCPUs. Reduce the number of vCPUs for the VM (and adjust the pod's `requests` accordingly).",
                    diag_workflow_step3: "<strong>Hypervisor Layer (Host):</strong> If `%CSTP` is low, check `%RDY`. A high `%RDY` (>5-10%) means the ESXi host is overloaded with CPU demand, and VMs are waiting to be scheduled. The solution is to migrate VMs to other hosts or add more capacity.",
                    diag_workflow_step4: "<strong>Application Layer (Code):</strong> If none of the above infrastructure metrics show issues, the root cause is likely within the application code itself. Use profiling tools to find bottlenecks.",
                    node_metrics_warning_title: "Beware of Node Metrics!",
                    node_metrics_warning_desc: "A node's CPU utilization might be low (e.g., 20%), but pods within it could be suffering from high throttling and latency spikes. Always check pod-level throttling metrics, not just the node's CPU.",
                    prometheus_monitoring_title: "Monitoring Throttling with Prometheus",
                    prometheus_monitoring_desc: "To calculate the throttling percentage for a container, you can use the following PromQL query. It measures the ratio of throttled periods to total periods.",
                    diag_table_metric: "Metric",
                    diag_table_layer: "Layer",
                    diag_table_cause: "Likely Root Cause",
                    diag_table_threshold: "Threshold",
                    diag_table_rdy_cause: "CPU oversubscription at the host level.",
                    diag_table_cstp_cause: "Oversized VM (too many vCPUs).",
                    diag_table_throttle_cause: "Pod's CPU limit is too low. Causes latency spikes even on a node with free CPU.",
                    diag_table_throttle_threshold: "Zero (for sensitive apps)",
                    strategies_title: "Optimization Strategies",
                    strategies_intro: "Once the problem is diagnosed, a solution is needed. This final section provides a set of strategies and best practices, from fundamental resource tuning (right-sizing) to advanced techniques like workload isolation and CPU pinning, to optimize the performance of your applications in production.",
                    strat_rightsizing_title: "1. Continuous Right-Sizing",
                    strat_rightsizing_desc: "Align allocated resources with actual usage. For CPU `requests`, a good starting point is the 95th percentile (p95) of historical usage. Use <strong>VPA</strong> in recommendation mode to get these figures.",
                    strat_limits_title: "2. Managing CPU Limits: When and When Not?",
                    strat_limits_avoid_title: "Avoid Limits (General Rule)",
                    strat_limits_avoid_desc: "For latency-sensitive services (APIs, frontends), <strong>do not set CPU limits</strong>. Rely on well-tuned `requests` to allow for usage spikes without the risk of throttling.",
                    strat_limits_use_title: "Use Limits (Exceptions)",
                    strat_limits_use_desc: "Limits can be useful for non-critical jobs (e.g., batch, ETL) where predictable performance is not the priority, but limiting resource consumption to avoid affecting other services is.",
                    strat_isolate_title: "3. Isolate Workloads",
                    strat_isolate_desc: "Use `Namespaces` with `ResourceQuotas` to set consumption limits per team. For stricter physical isolation, dedicate specific nodes to certain workloads using `Taints` and `Tolerations` or `Node Affinity`. This prevents non-critical applications (batch) from competing for resources with latency-sensitive services (APIs), a phenomenon known as the 'noisy neighbor' problem.",
                    strat_pinning_title: "4. CPU Pinning (Advanced)",
                    strat_pinning_desc: "For ultra-low latency workloads (e.g., high-frequency trading, telecommunications), use the `static` policy of Kubernetes' <strong>CPU Manager</strong>. This assigns exclusive CPU cores to a pod's containers, eliminating 'jitter' (latency variability) caused by scheduler context switching. The trade-off is lower pod density per node, as the assigned cores cannot be shared.",
                    strat_profiling_title: "5. Profile the Application",
                    strat_profiling_desc: "If infrastructure metrics look good, the problem might be in the code. Use `kubectl top` and continuous profiling tools (e.g., <strong>Parca, Pyroscope</strong>) to find bottlenecks in the code.",
                    flame_graph_placeholder: "[Example of a flame graph for CPU profiling]",
                    footer_text: "Interactive guide to simplify the understanding of complex performance concepts."
                }
            };

            // --- GLOBAL VARIABLES ---
            const navButtons = document.querySelectorAll('.nav-button');
            const contentSections = document.querySelectorAll('.content-section');
            const langButtons = {
                es: document.getElementById('lang-es'),
                en: document.getElementById('lang-en')
            };
            let htChart, rdyChart, cstpChart, throttleChart;
            let currentLang = 'es'; // Default language

            // --- CORE FUNCTIONS ---

            /**
             * Sets the application language and updates all UI elements.
             * @param {string} lang - The language code ('es' or 'en').
             */
            function setLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;

                // Update all elements with data-translate attribute
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.getAttribute('data-translate');
                    if (translations[lang] && translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                });

                // Update active language button
                Object.values(langButtons).forEach(btn => btn.classList.remove('active'));
                if (langButtons[lang]) {
                    langButtons[lang].classList.add('active');
                }
                
                // Re-create charts with translated text
                if (htChart) htChart.destroy();
                createHtChart();

                // Update diagnostic chart descriptions
                const currentScenario = document.getElementById('scenario-selector')?.value || 'healthy';
                updateDiagnosticCharts(currentScenario);
            }

            /**
             * Switches the visible content section based on navigation.
             * @param {string} targetId - The ID of the section to show.
             */
            function switchTab(targetId) {
                navButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.target === targetId);
                });
                contentSections.forEach(section => {
                    section.classList.toggle('active', section.id === targetId);
                });
            }

            // --- CHART CREATION ---

            function createHtChart() {
                const ctx = document.getElementById('htChart')?.getContext('2d');
                if (!ctx) return;
                const slider = document.getElementById('workload-slider');
                const label = document.getElementById('workload-label');

                htChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [translations[currentLang].ht_chart_label_single, translations[currentLang].ht_chart_label_ht],
                        datasets: [{
                            label: translations[currentLang].ht_chart_dataset_label,
                            data: [100, 100 + parseInt(slider.value)],
                            backgroundColor: ['rgba(245, 158, 11, 0.6)', 'rgba(16, 185, 129, 0.6)'],
                            borderColor: ['rgba(245, 158, 11, 1)', 'rgba(16, 185, 129, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, max: 140, ticks: { callback: value => value + '%' } } },
                        plugins: { legend: { display: false }, title: { display: true, text: translations[currentLang].ht_chart_title } }
                    }
                });

                const updateSliderLabel = (value) => {
                    if (value < 20) label.textContent = translations[currentLang].workload_label_low;
                    else if (value > 25) label.textContent = translations[currentLang].workload_label_high;
                    else label.textContent = translations[currentLang].workload_label_mixed;
                };

                slider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    htChart.data.datasets[0].data[1] = 100 + value;
                    htChart.update();
                    updateSliderLabel(value);
                });
                updateSliderLabel(parseInt(slider.value)); // Initial label set
            }

            function createDiagnosticCharts() {
                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 25, ticks: { callback: value => value + '%' } } },
                    plugins: { legend: { display: false } }
                };

                const rdyCtx = document.getElementById('rdyChart')?.getContext('2d');
                if (rdyCtx) rdyChart = new Chart(rdyCtx, { type: 'bar', data: { labels: ['%RDY'], datasets: [{ data: [2], backgroundColor: ['rgba(16, 185, 129, 0.6)'] }] }, options: commonOptions });
                
                const cstpCtx = document.getElementById('cstpChart')?.getContext('2d');
                if(cstpCtx) cstpChart = new Chart(cstpCtx, { type: 'bar', data: { labels: ['%CSTP'], datasets: [{ data: [0.5], backgroundColor: ['rgba(16, 185, 129, 0.6)'] }] }, options: commonOptions });

                const throttleCtx = document.getElementById('throttleChart')?.getContext('2d');
                if(throttleCtx) throttleChart = new Chart(throttleCtx, { type: 'bar', data: { labels: ['Throttling'], datasets: [{ data: [0], backgroundColor: ['rgba(16, 185, 129, 0.6)'] }] }, options: commonOptions });
            }

            function updateDiagnosticCharts(scenario) {
                if (!rdyChart || !cstpChart || !throttleChart) return;
                
                const scenarios = {
                    healthy:      { rdy: 2,  cstp: 0.5, throttle: 0 },
                    oversubscribed: { rdy: 20, cstp: 1,   throttle: 0 },
                    oversized:    { rdy: 3,  cstp: 15,  throttle: 0 },
                    throttled:    { rdy: 2,  cstp: 0.5, throttle: 22 }
                };
                const data = scenarios[scenario];
                
                const updateChart = (chart, value) => {
                    chart.data.datasets[0].data[0] = value;
                    chart.data.datasets[0].backgroundColor[0] = value > 10 ? 'rgba(239, 68, 68, 0.6)' : (value > 5 ? 'rgba(245, 158, 11, 0.6)' : 'rgba(16, 185, 129, 0.6)');
                    chart.update();
                };

                updateChart(rdyChart, data.rdy);
                updateChart(cstpChart, data.cstp);
                updateChart(throttleChart, data.throttle);

                document.getElementById('rdy-desc').textContent = translations[currentLang][`rdy_desc_${scenario}`];
                document.getElementById('cstp-desc').textContent = translations[currentLang][`cstp_desc_${scenario}`];
                document.getElementById('throttle-desc').textContent = translations[currentLang][`throttle_desc_${scenario}`];
            }

            // --- THEME TOGGLE ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const lightIcon = document.getElementById('theme-toggle-light-icon');

            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                lightIcon.classList.remove('hidden');
            } else {
                darkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', function() {
                darkIcon.classList.toggle('hidden');
                lightIcon.classList.toggle('hidden');
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    }
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
            });

            // --- INITIALIZATION ---
            
            // Event listeners for navigation
            navButtons.forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.target));
            });

            // Event listeners for language switching
            langButtons.es.addEventListener('click', () => setLanguage('es'));
            langButtons.en.addEventListener('click', () => setLanguage('en'));

            // Event listener for diagnostic scenario selector
            document.getElementById('scenario-selector')?.addEventListener('change', (e) => {
                updateDiagnosticCharts(e.target.value);
            });
            
            // Initial setup
            createDiagnosticCharts();
            setLanguage(currentLang); // Set initial language and render content
        });
    </script>

</body>
</html>
